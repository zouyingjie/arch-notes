<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta property="og:url" content="https://abc/kubernetes/02.kubernetes_pod.html"><meta property="og:site_name" content="架构笔记"><meta property="og:title" content="Pod 那些事"><meta property="og:description" content="Pod 是 Kubernetes 中最重要的概念之一"><meta property="og:type" content="article"><meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/82d9d8913e5e92de88d805c680a6d988.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-10-31T09:08:49.000Z"><meta property="article:tag" content="Kubernetes"><meta property="article:modified_time" content="2024-10-31T09:08:49.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Pod 那些事","image":["https://i-blog.csdnimg.cn/blog_migrate/82d9d8913e5e92de88d805c680a6d988.png","https://i-blog.csdnimg.cn/blog_migrate/04a5fe6db3a970db0b06c30fddaa2295.png","https://i-blog.csdnimg.cn/blog_migrate/c5a702137aef212ed22ea7b0a71169ad.png","https://i-blog.csdnimg.cn/blog_migrate/c093e21480708a1c7c7fdab68392d94a.png","https://i-blog.csdnimg.cn/blog_migrate/2b19f13682624963a87c61b4b280abd5.png","https://i-blog.csdnimg.cn/blog_migrate/fd49c26fe3f8be73e9f9d5a8a2188aa6.png","https://i-blog.csdnimg.cn/blog_migrate/104379ccb608e1fae1dcbe59054aad91.png","https://i-blog.csdnimg.cn/blog_migrate/c1cf81e9997b195ba4d98e547217bcb5.png"],"dateModified":"2024-10-31T09:08:49.000Z","author":[]}</script><link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.json"><title>Pod 那些事 | 架构笔记</title><meta name="description" content="Pod 是 Kubernetes 中最重要的概念之一">
    <link rel="preload" href="/assets/style-BGiMcUT_.css" as="style"><link rel="stylesheet" href="/assets/style-BGiMcUT_.css">
    <link rel="modulepreload" href="/assets/app-D-gFUe8_.js"><link rel="modulepreload" href="/assets/02.kubernetes_pod.html-BiskKWsE.js">
    <link rel="prefetch" href="/assets/index.html-Bm36x10y.js" as="script"><link rel="prefetch" href="/assets/SUMMARY.html-9_HYDJlb.js" as="script"><link rel="prefetch" href="/assets/get-started.html-DlfTTkCw.js" as="script"><link rel="prefetch" href="/assets/01.kubernetes_roadmap.html-DzwBXUfX.js" as="script"><link rel="prefetch" href="/assets/rest.html-BlxYxHOU.js" as="script"><link rel="prefetch" href="/assets/swagger.html-BZSD_kNt.js" as="script"><link rel="prefetch" href="/assets/webapi.html-B63V8btk.js" as="script"><link rel="prefetch" href="/assets/spring-boot-unit-testing.html-8CYez3q9.js" as="script"><link rel="prefetch" href="/assets/unit-test.html-DMX3vw24.js" as="script"><link rel="prefetch" href="/assets/404.html-Bdc787EN.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/images/microservices-logo.svg" alt="架构笔记"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">架构笔记</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://zouyingjie.github.io" aria-label="关于我" rel="noopener noreferrer" target="_blank"><!---->关于我<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zouyingjie/arch-notes" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://zouyingjie.github.io" aria-label="关于我" rel="noopener noreferrer" target="_blank"><!---->关于我<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zouyingjie/arch-notes" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/common-design/" aria-label="通用设计"><!---->通用设计<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><p tabindex="0" class="vp-sidebar-item">API 设计 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/common-design/api-design/rest.html" aria-label="REST API 设计最佳实践"><!---->REST API 设计最佳实践<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/common-design/api-design/webapi.html" aria-label="Web API 路径设计哪家强"><!---->Web API 路径设计哪家强<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/common-design/api-design/swagger.html" aria-label="实践：Spring Boot 集成 Swagger"><!---->实践：Spring Boot 集成 Swagger<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item">软件测试 <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/common-design/software-testing/unit-test.html" aria-label="单元测试那些事"><!---->单元测试那些事<!----></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/kubernetes/" aria-label="Kubernetes"><!---->Kubernetes<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/kubernetes/01.kubernetes_roadmap.html" aria-label="Kubernetes 架构概览"><!---->Kubernetes 架构概览<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/kubernetes/02.kubernetes_pod.html" aria-label="Pod 那些事"><!---->Pod 那些事<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h3 id="_1-为什么需要-pod" tabindex="-1">1. 为什么需要 Pod</h3><p>Pods 是 K8s 中最小的可部署和管理单元，是一个逻辑概念。一个 Pod 包含一个或多个 container，它们可以<strong>共享网络和存储</strong>，可以把 Pod 看作是一个虚拟的逻辑主机，里面包含了一个或多个紧密关联的 container，Pod 同时也告知系统如何去运行它所描述的容器。</p><p>Pod 的存在主要是为了解决两个问题：</p><ul><li>对“进程组”的抽象，满足容器共享 namespace 的需求。</li><li>协同调度</li></ul><p>容器本身是单进程模型，其应用本身的 PID 为 1，本身没有管理多个进程的能力。在实际应用中，往往存在着需要「超亲密关系」的进程，它们必须要运行在同一机器上共享存储、网络等，而 Pod 其实就是一组共享了网络、存储、IPC、UTS 以及时间的的容器，它们只有 PID 和文件 namespace 是默认隔离的，可以满足这种超亲密关系的要求。</p><p>与此同时，对于这类超亲密关系的进程，在跨机器的集群中，它们必须被部署到同一台机器上。如果以容器为调度单位，对资源的要求就只能在容器上设置，此时当多个超亲密容器需要协同调度时，资源越紧张，容器被调度到不同机器的可能性越大。</p><p>如果以 Pod 为原子单位进行调度，则对资源的设置可以定义在 Pod 上，此时只需要以 Pod 为单位统一调度即可，不需要在考虑单个容器的情况。</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/82d9d8913e5e92de88d805c680a6d988.png" alt="在这里插入图片描述"></p><p>Pod 可以由用户直接创建，也可以通过 Controller 对象创建。一般来说，Pod 极少直接被单独创建，一般会由用户使用 Deployment，Job，StatefulSet 等实际工作资源，基于其 PodTemplate 创建。另外也可以由 kubelet 直接创建并管理，这类 Pod 称为 StaticPod，像 etcd、api-server 这些 master 节点组件都是 StaticPod。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span></span>
<span class="line">  <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">run</span><span class="token punctuation">:</span> nginx</span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx</span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx</span>
<span class="line">  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always</span>
<span class="line"><span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当Pod完成它的工作后，会被删除，同时也有可能会因为缺乏资源，Node节点的失败而被驱逐。 给定的Pod（由UID定义）永远不会“重新安排”到其他节点，如果 Pod 失败退出，K8s 会创建一个新的 Pod 来替换。</p><h3 id="_2-pod-状态" tabindex="-1">2. Pod 状态</h3><h4 id="_2-1-podstatus" tabindex="-1">2.1 PodStatus</h4><p>Pod的状态是一个 PodStatus 对象，在 Pod 定义中是 status 字段， 其中包含一个pod.status.phase 字段表示当前的状态，可以取如下的值</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Pending</td><td>表示 Pod 对象已被创建保存在 etcd 中，但有一个或多个容器还不能被顺利创建。当等待调度或者拉取镜像时一般处在该状态。</td></tr><tr><td>Running</td><td>Pod 已经调度到某一节点并且所有容器都已经创建成功，并且至少有一个容器正在运行或者正在启动/重启。</td></tr><tr><td>Succeed</td><td>所有容易都正常运行并退出，并且不会重启。一般在运行一次性任务时最为常见。</td></tr><tr><td>Failed</td><td>所有容器已终止，并且至少有一个以不正常状态退出。此时我们一般需要通过查看 Pod 信息或日志来调试问题。</td></tr><tr><td>Unknown</td><td>异常状态，Pod 状态无法被 kube-apiserver 获取到。一般是 Pod 节点与 api-server 通信出现异常导致的。</td></tr></tbody></table><h4 id="_2-2-pod-conditions" tabindex="-1">2.2 Pod Conditions</h4><p>除了 status.phase 字段表示状态之外，Pod 还有一组 PodConditions 对象，对应字段是 pod.status.conditions 数组字段来描述 Pod 处于某个 phase 的具体原因，主要有下面几个值：</p><ul><li><strong>PodScheduled</strong>：Pod 已经被调度到指定节点。</li><li><strong>ContainersReady</strong>：Pod内所有的容器已经就绪。</li><li><strong>Initialized</strong>：所有的 init containers 已经成功启动。</li><li><strong>Ready</strong>：Pod 可以对外提供服务，可以作为 endpoints 给 Service 代理。</li></ul><p>PodConditions 对象包含如下的字段</p><table><thead><tr><th>type</th><th>类型名称， 上面四个取值之一</th></tr></thead><tbody><tr><td>status</td><td>True， False， Unkonwn 指示这个状况是否就绪</td></tr><tr><td>lastProbeTime</td><td>最后一个探测状况的时间戳</td></tr><tr><td>lastTransitionTime</td><td>Pod上一次状况变换的时间戳</td></tr><tr><td>reason</td><td>状况最后一次变化的原因， Machine-readable</td></tr><tr><td>message</td><td>状况最后一次变化的原因，Human-readable message</td></tr></tbody></table><h4 id="_2-3-container-states" tabindex="-1">2.3 Container States</h4><p>Pod 中容器也有状态，主要有下面三个值</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Waiting</td><td>等待状态。表示容器仍在执行启动所需的操作，比如拉取镜像、注入数据等。</td></tr><tr><td>Running</td><td>运行状态。表示容器正常运行，如果容器配置了 postStart 命令，该命令已经执行并结束了</td></tr><tr><td>Terminated</td><td>终止状态。容器完成任务或者执行失败，如果容器配置了 preStop 命令，必须在该命令执行完成后进行该状态，换句话说，preStop 会阻塞 container 的终止。</td></tr></tbody></table><h4 id="_2。4-container-restart-policy" tabindex="-1">2。4 Container restart policy</h4><p>容器的重启策略，有三个取值，</p><ul><li><strong>Always（默认值）</strong>：只要不在运行状态就自动重启</li><li><strong>OnFailure</strong>：在容器异常时自动重启</li><li><strong>Never</strong>：从不重启</li></ul><p>Pod 状态与容器状态的对应关系简要总结如下：</p><ul><li>如果 Pod 的 restartPolicy 指定允许容器重启，当有容器异常时， Pod 会一直保持 Running 状态并重启容器，否则Pod 会进入 Faied 状态。</li><li>对于多容器的 Pod，只有所有容器都进入异常状态后，Pod 才会进入 Failed，在此之前一直是 Running 状态。查看 Pod 的 Ready 字段会显示正常如果您器个数。</li></ul><h4 id="_2-5-lifecycle" tabindex="-1">2.5 Lifecycle</h4><p>上面提到了容器可以配置 postStart 和 preStop 命令。这是容器在发生状态变化时可以触发的一系列 hook操作：</p><ul><li><strong>postStart</strong>：在 Docker 容器启动后立即执行，即 ENTRYPOINT 执行之后执行，但并不保证顺序，postStart 执行时 ENTRYPOINT 命令可能尚未结束。postStart 会阻塞容器状态变化，在 postStart 执行完成前，容器的状态不会设置为 Running。</li><li><strong>preStop</strong>：在容器被杀死进入 Terminated 状态前执行，会阻塞容器杀死进程。Kubernetes 仅在 Pod 终止时执行 preStop，在完成时不会调用，相关 issues。</li></ul><p>命令的操作操作方式有两种：</p><ul><li><strong>exec</strong>：执行一段命令</li><li><strong>http</strong>: 执行一个请求</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> lifecycle<span class="token punctuation">-</span>demo</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> lifecycle<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>container</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx</span>
<span class="line">    <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">postStart</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">exec</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;echo Hello from the postStart handler &gt; /usr/share/message&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token key atrule">preStop</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">exec</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/usr/sbin/nginx&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-s&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;quit&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-pod-probe" tabindex="-1">3. Pod Probe</h3><p>探针是由 kubelet 发起的一种容器诊断行为，可以用来检测 Pod 中的容器的健康情况。Kubernetes 中主要有三种探针：</p><ul><li><strong>livenessProbe</strong>：存活探针，检查容器的健康状态，以决定是否重启容器。</li><li><strong>readinessProbe</strong>：就绪探针，用来检测容器是否准备好接收外部流量。该探针执行成功后 Pod 的细分状态就会变为 Ready，此时 Pod 可以作为 endpoints 给 Service 进行代理。</li><li><strong>startupProbe</strong>：启动探针，来判断容器是否启动，该类型探针会屏蔽上述两种探针。可以避免因为容器启动过长导致的死循环问题。如果失败则会重启容器。</li></ul><p>上述三类探针，如果没有提供， 默认对应的状态是 Succeess。</p><p>kubelet 通过调用 handler 实现对容器的诊断。 有三种类型的Handler</p><ul><li><strong>ExecAction</strong>: 执行一条用户提供的命令（例如“ls” 等）</li><li><strong>TCPSocketAction</strong>: 用TCP 协议探测指定端口是否能通</li><li><strong>HttpGetAction</strong>: 用HTTP GET 请求探测指定URL 是否正常返回200</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> goproxy</span>
<span class="line">  <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">app</span><span class="token punctuation">:</span> goproxy</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> goproxy</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> k8s.gcr.io/goproxy<span class="token punctuation">:</span><span class="token number">0.1</span></span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span></span>
<span class="line">    <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span></span>
<span class="line">      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span></span>
<span class="line">      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span></span>
<span class="line">    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span></span>
<span class="line">      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">15</span></span>
<span class="line">      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">20</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>什么时候启用livenessProbe</strong></p><p>如果容器中的进程在出现问题时可以自行正常崩溃，此时是不需要存活探针的，kubelet 会探测到容器的状态并基于 restartPolicy 执行相应的操作。</p><p>但有时候容器进程虽然没有挂掉，但其实已经无法提供服务了，比如遇到死锁，从进程检查的角度它是没问题的。我们可能需要通过访问业务逻辑来判断容器进程是否安全，此时可以使用 livenessProbe。</p><p><strong>什么时候启用 readinessProbe</strong></p><p>就绪探针决定的是容器是否已经启动就绪并可以接收外部的流量，因此如果某个需要接收外部流量的的容器进程启动较慢，可以设置 readinessProbe 来确认容器是否已经就绪。比如对于 Java/Spring 应用，其启动往往较慢，此时为其设置就绪探针是一个不错的选项。</p><p><strong>什么时候启用 startupProbe</strong></p><p>针对容器进程启动较慢的情况，可以设置启动指针。避免因为长时间未启动引发 livenessProbe 探测失败导致重启，陷入不断重启的“死循环”中。</p><h3 id="_4-init-container" tabindex="-1">4. Init container</h3><p>Init Container 是一种特殊容器，在 Pod 内的应用容器启动之前运行，一般用来执行初始化操作，比如安装应用镜像中不存在的实用工具和脚本。每个 Pod 中可以包含多个应用容器，应用运行在这些容器里面，同时 Pod 也可以有一个或多个先于应用容器启动的 Init Container。</p><p>initContainer 容器有两个特点：</p><ul><li>按顺序执行</li><li>它们总是运行到完成，每个 Init Container 必须在下一个容器启动前成功完成。</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line"> <span class="token key atrule">name</span><span class="token punctuation">:</span> www</span>
<span class="line"> <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">   <span class="token key atrule">app</span><span class="token punctuation">:</span> www</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line"> <span class="token key atrule">initContainers</span><span class="token punctuation">:</span></span>
<span class="line"> <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> download</span>
<span class="line">   <span class="token key atrule">image</span><span class="token punctuation">:</span> execlb/git</span>
<span class="line">   <span class="token key atrule">command</span><span class="token punctuation">:</span></span>
<span class="line">   <span class="token punctuation">-</span> git</span>
<span class="line">   <span class="token punctuation">-</span> clone</span>
<span class="line">   <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//github.com/mdn/beginner<span class="token punctuation">-</span>html<span class="token punctuation">-</span>site<span class="token punctuation">-</span>scripted</span>
<span class="line">   <span class="token punctuation">-</span> /var/lib/data</span>
<span class="line">   <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">   <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/lib/data</span>
<span class="line">     <span class="token key atrule">name</span><span class="token punctuation">:</span> source</span>
<span class="line"> <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line"> <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> run</span>
<span class="line">   <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/centos/httpd</span>
<span class="line">   <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">   <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span></span>
<span class="line">   <span class="token comment"># Shared volume with main container</span></span>
<span class="line">   <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">   <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/www/html</span>
<span class="line">     <span class="token key atrule">name</span><span class="token punctuation">:</span> source</span>
<span class="line"> <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line"> <span class="token punctuation">-</span> <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">   <span class="token key atrule">name</span><span class="token punctuation">:</span> source</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意事项</strong></p><ol><li>Init Container 不支持 lifecycle、livenessProbe、readinessProbe 和 startupProbe， 因为它们必须在 Pod 就绪之前运行完成。</li><li>只有所有 Init Container 都执行成功， Pod才能切换到Ready condition；只要任意一个失败就会触发 Pod 的 restartPolicy。</li><li>Pod 重新启动时，所有的 Init Container 会重新执行一遍，因此 Init Container 的执行结果应该是幂等的。</li><li>Init Container 执行时 Pod 的condition是 Initialized，status 为true, 但是Phase 是Pending；另外 readniessProbe 不能应用于 Init Container，Init Container 并不能代表Pod 就绪。</li><li>在 Container上设置 livenessProbe 和在Pod上 activeDeadlineSeconds可以避免 init container 死循环失败，activeDeadlineSeconds 将会作用于所有的Init 容器。</li><li>Init Container 的 image 更新将会重启整个Pod， 应用容器的镜像更新只重启应用容器。</li></ol><p><strong>资源计算</strong></p><p>Init Container 中可以设置对 CPU、内存资源的 request/limit ，因此也会影响 Pod 的资源计划。Pod 对资源的有效 request/limit 取决于下面两者中的最大值：</p><ul><li>所有应用容器的 request/limit 之和</li><li>Init containers 中的 request/limit 最大值</li></ul><p>尽量使 Init Container 的 request/limit 小于应用容器的 request/limit。因为 Pod 调度是基于有效 request/limit 资源的， Init Container 原因申请过多资源，但在 Pod 生命周中实际用不了这么多资源，从而造成资源浪费。</p><h3 id="_5-podpreset" tabindex="-1">5. PodPreset</h3><p>PodPreset 用来为 Pod 设置预设值，可以自动为对应的 Pod 添加其他必要的信息，比如 labels、annotations、volumes 等。</p><p>启动该功能需要两步：</p><ul><li>启用 <code>settings.k8s.io/v1alpha1/podpreset</code> API：在 api-server 启动时的 --runtime-config 中添加 ettings.k8s.io/v1alpha1=true。</li><li>启用准入控制器：在 <code>--enable-admission-plugins</code> 参数找那个添加 PodPreset。</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> settings.k8s.io/v1alpha1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> PodPreset</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> allow<span class="token punctuation">-</span>database</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">selector</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">role</span><span class="token punctuation">:</span> frontend</span>
<span class="line">  <span class="token key atrule">env</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DB_PORT</span>
<span class="line">      <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;6379&quot;</span></span>
<span class="line">  <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /cache</span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>volume</span>
<span class="line">  <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cache<span class="token punctuation">-</span>volume</span>
<span class="line">      <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PodPreset 工作流程</strong></p><p>当开启 PodPreset 时，Kubernetes 会提供一个名为 PodPreset 的准入控制器（ Admission controller ）, 这个控制器将在Pod 创建请求到来时应用预设功能。当Pod创建发生时， 系统执行如下的步骤：</p><ul><li>获取可用的预设值</li><li>检查Pod的标签是否和预设值的标签匹配。</li><li>在Pod创建的时候，尝试合并在 Pod 预设值中定义的各种资源。</li><li>如果合并失败， 则记录Pod的合并资源失败事件，并创建没有注入预设值的 Pod 资源。</li><li>被 PodPreset 改动过的 Pod 会带有 annotation：<code>podpreset.admission.kubernetes.io/podpreset-&lt;pod-preset name&gt;: &quot;&lt;resource version&gt;</code> 的形式</li></ul><p>每个 Pod 可以匹配 0 或者多条预设值， 每个预设值可以和 0 到多个 Pod 相匹配。当一个 PodPreset 应用到一个或多个Pod时， K8s将会更改Pod的Spec：</p><ul><li>对于env， envFrom 和 volumeMounts， K8s会修改Pod内的所有Containe的Container Spec。</li><li>对于volume， K8s 修改 Pod 的 Spec。</li></ul><p>如果希望将某些 Pod 禁用 PodPreset，可以在 Pod 中添加 <code>podpreset.admission.kubernetes.io/exclude: &quot;true&quot;</code> 注解。</p><h3 id="_6-disruption" tabindex="-1">6. Disruption</h3><p>PDB (Pod disruption budgets) 是指应该应用程序它所期望容忍的最小副本数。 例如，如果一个Deployment 有 .spec.replicas:5 表示在任何时间他将有5个副本。 如果PDB 允许在某个时间为4个服务，那么由Eviction API引发的主动删除Pod副本的将会只会同一时刻删除一个副本（确保总有4个副本在运行）。</p><p>PDB 不能阻止非主动宕机（involuntary disruption) 的发生。</p><p>Pod “主动”（intended）副本数量是由管理POD的 workload 资源 （deployment，statefulset）的。.spec.replicas 中计算得出。 控制面通过检查 pod的.metadata.ownerReferences 来确定 Pod所属的 workload 资源</p><p>在进行滚动更新的Pod将会参考PDB， workload 资源在执行滚动更新时缺不受PDB的限制，而是在应用升级时，由workload资源指定在Spec中的配置的失败处理 （？？？）</p><p>使用驱逐API（Evication API）逐出容器后，该容器会被优雅终止，并遵循其PodSpec中的<code>terminationGracePeriodSeconds</code>设置</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> policy/v1beta1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> PodDisruptionBudget</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> zk<span class="token punctuation">-</span>pdb</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">selector</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">app</span><span class="token punctuation">:</span> zk</span>
<span class="line">  <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-临时容器-ephemeral-containers" tabindex="-1">7. 临时容器（Ephemeral Containers）</h3><p>ephemeral containers 主要是用于帮助用户来完成特定目的的比如诊断功能的容器。它临时地存在在一个容器内部。</p><p>当由于容器崩溃或容器镜像不包含调试工具而导致 kubectl exec 无用时， 临时容器对于交互式故障排查很有用。</p><p>尤其是，<a href="https://github.com/GoogleContainerTools/distroless" target="_blank" rel="noopener noreferrer">distroless 镜像</a> 允许用户部署最小的容器镜像，从而减少攻击面并减少故障和漏洞的暴露。 由于 distroless 镜像不包含 Shell 或任何的调试工具，因此很难单独使用 kubectl exec 命令进行故障排查。</p><p>使用临时容器时，启用<a href="https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/" target="_blank" rel="noopener noreferrer">进程名字空间共享</a> 很有帮助，可以查看其他容器中的进程。</p><p>ephemeral container 不会自动重启，所以不适合来做服务。他通过ContainerSpec 进行描述和普通容器描述相同，但是有如下的限制。</p><ul><li>临时容器没有端口配置，因此很多字段没有用， 如ports， livenessProbe，readinessProbe</li><li>Pod的资源是不变了， 所以 resource 也是不能被指定的。</li><li>完整的字段列表，参看 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.19/#ephemeralcontainer-v1-core" target="_blank" rel="noopener noreferrer">EphemeralContainer reference documentation.</a></li></ul><p>ephemeral container 不能直接被加入到pod.spec中， 需要通过在API中的特定的 ephemeralcontainers handler 进行处理。 所以用户是无法通过 kubectl edit 进行添加的。 和普通container一样，一旦你添加了 ephemeral container 你就不能将它在POD中移除和修改。</p><p>通过 kubectl --raw 命令可以创建一个 ephermeral container</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token key atrule">&quot;apiVersion&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token key atrule">&quot;kind&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;EphemeralContainers&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token key atrule">&quot;metadata&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token key atrule">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;example-pod&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token key atrule">&quot;ephemeralContainers&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token key atrule">&quot;command&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token string">&quot;sh&quot;</span></span>
<span class="line">        <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token key atrule">&quot;image&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;busybox&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token key atrule">&quot;imagePullPolicy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;IfNotPresent&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token key atrule">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;debugger&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token key atrule">&quot;stdin&quot;</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token key atrule">&quot;tty&quot;</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token key atrule">&quot;terminationMessagePolicy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;File&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用下面的命令，可以将ephermeral container 加到一个已经在运行的 example-pod 中 kubectl replace --raw /api/v1/namespaces/default/pods/example-pod/ephemeralcontainers -f ec.json</p><p>通过 kubectl describe pod 可以查看 pod中的ephemeral container</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">..</span>.</span>
<span class="line">Ephemeral Containers:</span>
<span class="line">  debugger:</span>
<span class="line">    Container ID:  docker://cf81908f149e7e9213d3c3644eda55c72efaff67652a2685c1146f0ce151e80f</span>
<span class="line">    Image:         busybox</span>
<span class="line">    Image ID:      docker-pullable://busybox@sha256:9f1003c480699be56815db0f8146ad2e22efea85129b5b5983d0e0fb52d9ab70</span>
<span class="line">    Port:          <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span></span>
<span class="line">    Host Port:     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span></span>
<span class="line">    Command:</span>
<span class="line">      <span class="token function">sh</span></span>
<span class="line">    State:          Running</span>
<span class="line">      Started:      Thu, <span class="token number">29</span> Aug <span class="token number">2019</span> 06:42:21 +0000</span>
<span class="line">    Ready:          False</span>
<span class="line">    Restart Count:  <span class="token number">0</span></span>
<span class="line">    Environment:    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span></span>
<span class="line">    Mounts:         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">..</span>.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以使用以下命令连接到新的临时容器：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">kubectl attach <span class="token parameter variable">-it</span> example-pod <span class="token parameter variable">-c</span> debugger</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果是网络问题也可以考虑使用 netshoot 工具：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-it</span>  <span class="token parameter variable">--net</span> container:<span class="token variable">${containerID}</span> nicolaka/netshoot</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_8-pod-cmd-args" tabindex="-1">8. Pod Cmd &amp; Args</h3><p>Pod 的定义中也可以为 Container 指定启动命令和参数，</p><ul><li>指定命令</li></ul><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> command<span class="token punctuation">-</span>demo</span>
<span class="line">  <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">purpose</span><span class="token punctuation">:</span> demonstrate<span class="token punctuation">-</span>command</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> command<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>container</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> debian</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;printenv&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;HOSTNAME&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;KUBERNETES_PORT&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token comment"># command: [&quot;/bin/sh&quot;]</span></span>
<span class="line">    <span class="token comment"># args: [&quot;-c&quot;, &quot;while true; do echo hello; sleep 10;done&quot;]</span></span>
<span class="line">  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> OnFailure</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Pod 中定义的 command 和 args 会覆盖掉 Dockerfile 中定义的启动命令，其覆盖关系如下：</p><p><strong>K8S command/args VS. Docker Entrypoint/Cmd</strong><img src="https://i-blog.csdnimg.cn/blog_migrate/04a5fe6db3a970db0b06c30fddaa2295.png" alt="在这里插入图片描述"></p><h3 id="_9-pod-的启动与终止" tabindex="-1">9. Pod 的启动与终止</h3><h4 id="_9-1-pod-启动流程" tabindex="-1">9.1 Pod 启动流程</h4><p>当创建一个 Pod 创建时上述组件工作过程如下：</p><ol><li>外部发起创建 Pod 请求，api-server 检查无误后将 Pod 存储到 etcd。如果是常见的 Deplpoyment 等控制器组件，则 controller 会执行状态拟合，创建期望数量的 Pod。</li><li>Scheduler 调度器发现新的未调度 Pod，基于资源需求、节点亲和、污点容忍等规则，将 Pod 调度到合适的节点。其操作就是修改 Pod 的 Spec，将 nodeName 字段设置为对应的节点名，然后存回 etcd。</li><li>对应节点上的 kubelet 检测到有新的 Pod 调度到该节点，执行如下操作： 【1】向容器运行时比如 contained 发送请求，创建 infra 容器。 【2】容器运行时调用 CNI 网络插件初始化 Pod 的网络命名空间。</li><li>如果存在 initContainer，kubelet 会请求 CRI 按顺序创建 init 容器。</li><li>kubelet 并发请求 CRI 创建 spec.containers 下定义的容器。</li><li>kubelet 监控容器，收集容器数据并上报给 api-server。</li></ol><p><img src="https://i-blog.csdnimg.cn/blog_migrate/c5a702137aef212ed22ea7b0a71169ad.png" alt="在这里插入图片描述"></p><p>图片来自: <a href="https://goglides.io/understanding-kubernetes-pods/713/" target="_blank" rel="noopener noreferrer">Goglides</a></p><h4 id="_9-2-pod-终止流程" tabindex="-1">9.2 Pod 终止流程</h4><p><img src="https://i-blog.csdnimg.cn/blog_migrate/c093e21480708a1c7c7fdab68392d94a.png" alt="在这里插入图片描述"></p><p>图片来自：<a href="https://goglides.io/understanding-kubernetes-pods/713/" target="_blank" rel="noopener noreferrer">Golides</a></p><h3 id="_10-pod-容器设计模式" tabindex="-1">10. Pod 容器设计模式</h3><p>很多时候若干个进程是需要紧密运行在同一台主机上的，比如 Linux 进程组下的进程。在容器编排调度中，对于某些超亲密的容器进程，它们也是必须被紧密的调度运行在同一主机环境中。类似于 Kubernetes 的 Pod、Nomad 中的 task-group 都是对这种超亲密关系的抽象。</p><p>Google 的两位技术人员对基于容器的设计模式总结了论文和PPT：</p><ul><li>论文：<a href="https://www.usenix.org/system/files/conference/hotcloud16/hotcloud16_burns.pdf" target="_blank" rel="noopener noreferrer">Design patterns for container-based distributed systems</a></li><li>课件：<a href="https://www.usenix.org/sites/default/files/conference/protected-files/hotcloud16_slides_burns.pdf" target="_blank" rel="noopener noreferrer">https://www.usenix.org/sites/default/files/conference/protected-files/hotcloud16_slides_burns.pdf</a></li></ul><h4 id="_10-1-sidecar" tabindex="-1">10.1 SideCar</h4><p>边车容器用来扩展和增强主容器的功能。在基于容器的分布式系统中，容器作为打包、重用的基本单位，其设计一般是符合单一职责原则的。此时如果我们需要一些额外的功能，可以通过 SideCar 容器实现。比如下载主容器所需的文件，收集主容器进程运行产生的日志等。</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/2b19f13682624963a87c61b4b280abd5.png" alt="在这里插入图片描述"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/fd49c26fe3f8be73e9f9d5a8a2188aa6.png" alt="在这里插入图片描述"></p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> web<span class="token punctuation">-</span>app</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/centos/httpd    </span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span></span>
<span class="line">    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/www/html       </span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> git</span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> poll</span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> axeclbr/git               </span>
<span class="line">    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/lib/data       </span>
<span class="line">      <span class="token key atrule">name</span><span class="token punctuation">:</span> git</span>
<span class="line">    <span class="token key atrule">env</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> GIT_REPO</span>
<span class="line">      <span class="token key atrule">value</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/mdn/beginner<span class="token punctuation">-</span>html<span class="token punctuation">-</span>site<span class="token punctuation">-</span>scripted</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;sh&quot;</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;-c&quot;</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token string">&quot;git clone $(GIT_REPO) . &amp;&amp; watch -n 600 git pull&quot;</span></span>
<span class="line">    <span class="token key atrule">workingDir</span><span class="token punctuation">:</span> /var/lib/data</span>
<span class="line">  <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> git</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SideCar 容器的使用有如下几个好处：</p><ul><li><strong>节约资源</strong>：容器作为资源分配的单位，可以将资源优先配置给主容器，而 sidecar 容器可以配置较少的资源，避免其资源占用过多影响主进程。</li><li><strong>职责分离</strong>：容器作为打包的单位，主容器和 sidecar 容器是可以分开单独开发并打包的。</li><li><strong>方便重用</strong>：容器也是重用的单位，sidecar 可以用来辅助不同的主容器。</li><li><strong>错误隔离</strong>：当某个容器出现问题时，可以单独的进行降级、升级、回滚等，尽量不影响其他容器的运行。</li></ul><h4 id="_10-2-ambassador" tabindex="-1">10.2 Ambassador</h4><p>大使模式，是一种特殊的 SideCar，用于代理容器的访问请求。比如主容器需要访问数据库获取资源，对于主容器而言，其看到的始终是与本地通信，所有的通信细节都由大使容器实现。</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/104379ccb608e1fae1dcbe59054aad91.png" alt="在这里插入图片描述"></p><p>下面是一个简单的示例，主容器产生的日志会经由 localhost:8080 的路径发送给 Ambassador 容器，然后经由 Ambassador 发送给不同的存储媒介。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> random<span class="token punctuation">-</span>generator</span>
<span class="line">  <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">app</span><span class="token punctuation">:</span> random<span class="token punctuation">-</span>generator</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> k8spatterns/random<span class="token punctuation">-</span>generator<span class="token punctuation">:</span><span class="token number">1.0</span>            </span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> main</span>
<span class="line">    <span class="token key atrule">env</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> LOG_URL                                    </span>
<span class="line">      <span class="token key atrule">value</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9009</span></span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span></span>
<span class="line">      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP</span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> k8spatterns/random<span class="token punctuation">-</span>generator<span class="token punctuation">-</span>log<span class="token punctuation">-</span>ambassador </span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> ambassador</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Adapter</p><p>适配器模式是另外一种特殊的 SideCar，和大使模式相反。大使模式是屏蔽的外部的变化，对主容器提供一致对外访问体验。而适配器模式则是屏蔽容器内部的变化，对外提供统一的访问模式。最常见的例子就是监控 API，比如 Prometheus，外界不用关心容器内部是怎样实现的，只需要访问固定的 API 获取指标就可以了。</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/c1cf81e9997b195ba4d98e547217bcb5.png" alt="在这里插入图片描述"></p><p>下面是一个 Adapter 的示例，Adapter用到了一个 nginx/nginx-prometheus-exporter 的一个镜像，该适配器会把 Nginx 的 stub staus 页转成 Prometheus 的 metrics，并放了9113端口和默认的 /mterics 的访问路径。</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span></span>
<span class="line">  <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">app</span><span class="token punctuation">:</span> adapter<span class="token punctuation">-</span>pattern</span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> adapter<span class="token punctuation">-</span>pattern</span>
<span class="line">  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> adapter</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">  <span class="token key atrule">selector</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">app</span><span class="token punctuation">:</span> adapter<span class="token punctuation">-</span>pattern</span>
<span class="line">  <span class="token key atrule">strategy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token key atrule">template</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span></span>
<span class="line">      <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">app</span><span class="token punctuation">:</span> adapter<span class="token punctuation">-</span>pattern</span>
<span class="line">    <span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>default<span class="token punctuation">-</span>conf<span class="token punctuation">-</span>volume</span>
<span class="line">        <span class="token key atrule">configMap</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>default<span class="token punctuation">-</span>conf</span>
<span class="line">      <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx</span>
<span class="line">        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.19.2</span>
<span class="line">        <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span></span>
<span class="line">        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/nginx/conf.d</span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>default<span class="token punctuation">-</span>conf<span class="token punctuation">-</span>volume</span>
<span class="line">          <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> adapter</span>
<span class="line">        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx/nginx<span class="token punctuation">-</span>prometheus<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span>0.8.0</span>
<span class="line">        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;-nginx.scrape-uri&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost/nginx_status&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9113</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span> <span class="token punctuation">:</span> debug</span>
<span class="line">        <span class="token key atrule">image</span><span class="token punctuation">:</span> nicolaka/netshoot</span>
<span class="line">        <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token key atrule">args</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;while true; do sleep 60; done&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/zouyingjie/arch-notes/edit/main/docs/kubernetes/02.kubernetes_pod.md" aria-label="在GitHub中编辑" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->在GitHub中编辑<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: yingjiezou1@gmail.com">zouyingjie</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/kubernetes/01.kubernetes_roadmap.html" aria-label="Kubernetes 架构概览"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Kubernetes 架构概览</span></div></a><!----></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-D-gFUe8_.js" defer></script>
  </body>
</html>
